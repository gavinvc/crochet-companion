<div class="community-page">
  <section class="community-hero">
    <div class="community-hero__copy">
      <p class="eyebrow">Groups</p>
      <h1>Find the right community to share posts, chat, and pattern-linked threads.</h1>
      <p class="lede">
        Browse active groups, filter by tags, and jump into threads that match your craft focus. Keep your hands on the yarn while
        the community keeps the ideas flowing.
      </p>
      <div class="hero-actions">
        <button type="button" class="cta primary" (click)="scrollToGroups()">Find a group</button>
        <button type="button" class="cta outline" (click)="openCreateModal()">Create a group</button>
      </div>
      <p *ngIf="error()" class="error">{{ error() }}</p>
    </div>
  </section>

  <section class="community-groups" id="groups">
    <header class="section-header">
      <div>
        <p class="eyebrow">Groups</p>
        <h2>Active community groups</h2>
        <p class="lede muted">Join to view posts and chat. Pattern links appear on cards and inside threads.</p>
      </div>
      <button type="button" class="ghost" (click)="loadGroups()" [disabled]="isLoading()">Refresh</button>
    </header>

    <div *ngIf="isLoading()" class="loading">Loading groups...</div>
    <p *ngIf="!isLoading() && groups().length === 0" class="empty">No groups yet. Create one to get started.</p>

    <div class="group-grid" *ngIf="groups().length > 0">
      <article *ngFor="let group of groups()">
        <div class="cover" *ngIf="group.coverImageUrl" [style.backgroundImage]="'url(' + group.coverImageUrl + ')'">
          <span class="pill">{{ group.memberCount }} members</span>
        </div>
        <div class="group-body">
          <h3>{{ group.name }}</h3>
          <p>{{ group.description || 'No description yet.' }}</p>
          <div class="tags" *ngIf="group.tags.length">
            <span class="tag" *ngFor="let tag of group.tags">{{ tag }}</span>
          </div>
          <div class="stats">
            <span>{{ group.postCount }} posts</span>
            <span>{{ group.messageCount }} chat msgs</span>
          </div>
          <div class="featured" *ngIf="group.featuredPatterns.length">
            <p class="subheading">Featured patterns</p>
            <div class="chips">
              <a *ngFor="let pattern of group.featuredPatterns" [routerLink]="['/patterns', pattern.id]" class="chip">
                {{ pattern.title || 'Pattern' }}
              </a>
            </div>
          </div>
          <div class="actions">
            <button type="button" class="secondary" (click)="open(group)">Open group</button>
            <button
              type="button"
              (click)="group.isMember ? leave(group) : join(group)"
              [class.ghost]="group.isMember"
            >
              {{ group.isMember ? 'Leave group' : 'Join group' }}
            </button>
          </div>
        </div>
      </article>
    </div>
  </section>

  <div class="modal-backdrop" *ngIf="showCreateModal()" (click)="closeCreateModal()">
    <article class="modal" role="dialog" aria-modal="true" aria-labelledby="create-group-title" (click)="$event.stopPropagation()">
      <header class="modal__header">
        <div>
          <p class="card-label">Create a group</p>
          <h2 id="create-group-title">Start a new community</h2>
          <p class="muted">Launch a focused space with posts, chat, and optional featured patterns.</p>
        </div>
        <button type="button" class="icon-button" (click)="closeCreateModal()" aria-label="Close">Ã—</button>
      </header>

      <form [formGroup]="createForm" (ngSubmit)="createGroup()" novalidate>
        <label>
          <span>Name</span>
          <input formControlName="name" placeholder="e.g., Texture Lab" />
        </label>

        <label>
          <span>Description</span>
          <textarea formControlName="description" rows="2" placeholder="What do you discuss?"></textarea>
        </label>

        <label>
          <span>Cover image URL</span>
          <input formControlName="coverImageUrl" placeholder="https://..." />
        </label>

        <label>
          <span>Tags (comma separated)</span>
          <input formControlName="tags" placeholder="granny squares, textured, beanies" />
        </label>

        <label>
          <span>Featured pattern IDs (comma separated)</span>
          <input formControlName="featuredPatternIds" placeholder="Optional pattern ids to highlight" />
        </label>

        <div class="modal__actions">
          <button type="button" class="ghost" (click)="closeCreateModal()">Cancel</button>
          <button type="submit" [disabled]="isCreating()">{{ isCreating() ? 'Creating...' : 'Launch group' }}</button>
        </div>
        <p *ngIf="createError()" class="error">{{ createError() }}</p>
        <p class="hint">Add pattern ids to spotlight references; members can also link patterns inside posts.</p>
      </form>
    </article>
  </div>
</div>

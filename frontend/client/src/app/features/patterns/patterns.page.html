<div class="patterns-page">
  <section class="patterns-hero">
    <div class="patterns-hero__copy">
      <p class="eyebrow">Pattern sharing</p>
      <h1>Share your pattern with images and rows everyone can walk through.</h1>
      <p class="lede">
        Publish a pattern with a cover image and numbered rows. Makers can follow it or open the row-by-row view just like a parsed pattern.
      </p>
      <div class="hero-stats">
        <div class="stat">
          <p class="value">Row-by-row</p>
          <p class="label">Guided playback</p>
        </div>
        <div class="stat">
          <p class="value">Images</p>
          <p class="label">Showcase your work</p>
        </div>
        <div class="stat">
          <p class="value">Follow</p>
          <p class="label">Save for later</p>
        </div>
      </div>
    </div>

    <article class="share-card share-card--form" id="share-form" *ngIf="auth.isLoggedIn(); else shareSignIn">
      <p class="card-label">Share a pattern</p>
      <form [formGroup]="shareForm" (ngSubmit)="sharePattern()" novalidate>
        <label>
          <span>Title</span>
          <input formControlName="title" placeholder="e.g., Cozy Moss Stitch Throw" />
        </label>

        <label>
          <span>Description</span>
          <textarea formControlName="description" rows="2" placeholder="Short description"></textarea>
        </label>

        <label>
          <span>Image URL (optional)</span>
          <input formControlName="imageUrl" placeholder="https://..." />
        </label>

        <label>
          <span>Rows (one per line)</span>
          <textarea formControlName="rowsInput" rows="5" placeholder="Row 1: ...&#10;Rows 3-5: repeat step..."></textarea>
        </label>

        <button type="submit" [disabled]="isSubmitting()">{{ isSubmitting() ? 'Saving...' : 'Publish pattern' }}</button>
      </form>
    </article>
    <ng-template #shareSignIn>
      <article class="share-card share-card--signin">
        <p class="card-label">Sign in to share</p>
        <p class="lede">Create an account to publish patterns with images and rows.</p>
        <a routerLink="/auth" class="cta">Go to sign in</a>
      </article>
    </ng-template>
  </section>

  <section class="maker-section" *ngIf="auth.isLoggedIn()">
    <header class="section-header">
      <div>
        <p class="eyebrow">Maker space</p>
        <h2>Your patterns</h2>
        <p class="lede muted">Quick access to what you published.</p>
      </div>
      <a class="cta ghost" href="#share-form">Create pattern</a>
    </header>

    <div class="maker-grid" *ngIf="myPatterns().length; else emptyMine">
      <article class="maker-card" *ngFor="let pattern of myPatterns()">
        <div class="maker-card__head">
          <h3>{{ pattern.title }}</h3>
          <span class="pill">{{ rowsPreview(pattern) }}</span>
        </div>
        <p class="maker-card__meta">{{ pattern.followerCount || 0 }} followers</p>
        <div class="maker-card__actions">
          <button type="button" (click)="openPattern(pattern)">Open</button>
          <button type="button" class="ghost" (click)="toggleFollow(pattern)">
            {{ pattern.isFollowing ? 'Unfollow' : 'Follow' }}
          </button>
          <button type="button" class="ghost danger" *ngIf="pattern.isOwner" (click)="deletePattern(pattern)">Delete</button>
        </div>
      </article>
    </div>
    <ng-template #emptyMine>
      <p class="empty">You have not published any patterns yet.</p>
    </ng-template>
  </section>

  <section class="maker-section" *ngIf="auth.isLoggedIn()">
    <header class="section-header">
      <div>
        <p class="eyebrow">Maker space</p>
        <h2>Followed patterns</h2>
        <p class="lede muted">Stay close to what inspires you.</p>
      </div>
    </header>

    <div class="maker-grid" *ngIf="followedPatterns().length; else emptyFollowing">
      <article class="maker-card" *ngFor="let pattern of followedPatterns()">
        <div class="maker-card__head">
          <h3>{{ pattern.title }}</h3>
          <span class="pill">{{ rowsPreview(pattern) }}</span>
        </div>
        <p class="maker-card__meta">{{ pattern.followerCount || 0 }} followers</p>
        <div class="maker-card__actions">
          <button type="button" (click)="openPattern(pattern)">Open</button>
          <button type="button" class="ghost" (click)="toggleFollow(pattern)">
            Unfollow
          </button>
        </div>
      </article>
    </div>
    <ng-template #emptyFollowing>
      <p class="empty">You are not following any patterns yet.</p>
    </ng-template>
  </section>

  <section class="pattern-list">
    <header>
      <p class="eyebrow">Community patterns</p>
      <h2>Follow or open any shared pattern.</h2>
      <p *ngIf="error()" class="error">{{ error() }}</p>
    </header>

    <div *ngIf="isLoading()" class="loading">Loading patterns...</div>

    <div *ngIf="!isLoading() && patterns().length === 0" class="empty">No patterns shared yet. Be the first to publish.</div>

    <div class="pattern-grid" *ngIf="patterns().length > 0">
      <article class="pattern-card" *ngFor="let pattern of patterns()">
        <div class="cover" *ngIf="pattern.imageUrl; else placeholder" [style.backgroundImage]="'url(' + pattern.imageUrl + ')'">
          <span class="pill">{{ rowsPreview(pattern) }}</span>
        </div>
        <ng-template #placeholder>
          <div class="cover placeholder">
            <span class="pill">{{ rowsPreview(pattern) }}</span>
          </div>
        </ng-template>

        <div class="card-body">
          <div class="card-title">
            <h3>{{ pattern.title }}</h3>
            <p>{{ pattern.description || 'No description provided.' }}</p>
          </div>

          <div class="meta">
            <span>By {{ pattern.author.handle }}</span>
            <span>Followers: {{ pattern.followerCount }}</span>
          </div>

          <div class="actions">
            <button type="button" (click)="toggleFollow(pattern)" [disabled]="!auth.isLoggedIn()">
              {{ pattern.isFollowing ? 'Unfollow' : 'Follow' }}
            </button>
            <button type="button" (click)="openPattern(pattern)" [class.secondary]="!auth.isLoggedIn()">
              {{ auth.isLoggedIn() ? 'Open' : 'Sign in to view' }}
            </button>
          </div>
        </div>
      </article>
    </div>
  </section>
</div>
